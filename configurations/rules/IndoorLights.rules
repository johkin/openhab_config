import org.joda.time.*
import org.openhab.core.library.types.DateTimeType
import org.openhab.core.library.items.SwitchItem
import org.openhab.core.items.GenericItem
import java.util.*

/* Presence, 0=HOME, 1=NIGHT, 2=AWAY 3=Vacation*/

val List<SwitchItem> pointLights = new ArrayList<SwitchItem>()

rule "IndoorLights, Tänd belysning vid hemma"
when 
	Item Presence changed to 0
then
	logDebug("IndoorLights", "Antal lampor att tända {}", pointLights.size)
	pointLights.forEach[
		light | 
		light.sendCommand(ON)
	]
	pointLights.clear()
end

rule "IndoorLights, Släck belysning vid borta"
when 
	Item Presence changed to 2
then
	pointLights.clear()
	gPointLight.allMembers.forEach[
		light | 
		if (light.state != OFF) {
			light.sendCommand(OFF)
			logDebug("IndoorLights", "Lägger till lampa {}", light)
			pointLights.add(light as SwitchItem)
		}
	]
	gCeilingLight.allMembers.forEach[
		light | 
		if (light.state != OFF) {
			light.sendCommand(OFF)
		}
	]
end

rule "IndoorLights, Släck belysning vid natt"
when 
	Item Mode changed to 1
then
	gPointLight.allMembers.forEach[
		light | 
		if (light.state != OFF) {
			light.sendCommand(OFF)
		}
	]
	/*
	gCeilingLight.allMembers.forEach[
		light | 
		if (light.state != OFF) {
			light.sendCommand(OFF)
		}
	]
	*/
	pointLights.clear()
end